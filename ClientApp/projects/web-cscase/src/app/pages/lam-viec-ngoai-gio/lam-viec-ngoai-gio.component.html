<div class="block">
    <div class="card p-4">
        <p-toolbar styleClass="mb-4 p-3">
            <p-card *ngIf="checkIsLeader()" header="header" style="font-weight: bold; font-size: x-large; color: navy;">
                üòí Qu·∫£n l√Ω l√†m vi·ªác ngo√†i gi·ªù
            </p-card>
            <p-card *ngIf="!checkIsLeader()" header="header"
                style="font-weight: bold; font-size: x-large; color: navy;">
                Th√¥ng tin l√†m vi·ªác ngo√†i gi·ªù
            </p-card>
            <ng-template
                *ngIf="checkIsLeader()"
                pTemplate="left">
                <button pButton pRipple
                    label="L∆∞u th·ªùi gian l√†m ngo√†i gi·ªù"
                    icon="pi pi-file-edit mb-1"
                    class="p-button-success py-2"
                    (click)="openAddDialog()">
                </button>
            </ng-template>
        </p-toolbar>

        <p-toolbar styleClass="mb-4 p-3">
            <div class="flex flex-row flex-wrap gap-3">
                <div class="mt-2">
                    <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                        (click)="clear(dt1)">
                    </button>
                </div>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_datefrom">
                    <label for="float-input">L·ªçc t·ª´ ng√†y</label>
                </span>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_dateto">
                    <label for="float-input">L·ªçc ƒë·∫øn ng√†y</label>
                </span>
                <span class="mt-2">
                    <!-- <button
              pButton pRipple type="button"
              label="L·ªçc"
              class="p-button-rounded p-button-info  px-4">
            </button> -->
                    <!-- <button pButton pRipple type="button" label="L·ªçc" class="p-button-outlined p-button-info px-4"></button> -->
                    <button pButton pRipple type="button" icon="pi pi-search" class="p-button-rounded p-button-info"
                        (click)="fetchDataFiltered()">
                    </button>
                </span>
            </div>
        </p-toolbar>

        <p-table #dt1 [value]="WorkingOTs" [rows]="10" [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]"
            [paginator]="true" [globalFilterFields]="['date', 'time', 'note']"
            styleClass="p-datatable-gridlines p-datatable-sm" reorderableColumns="true" responsiveLayout="scroll">
            <!-- dataKey="id" -->
            <!-- currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" -->
            <!-- styleClass="p-datatable-customers p-datatable-gridlines" -->

            <ng-template pTemplate="header">
                <tr>
                    <th *ngIf="checkIsLeader()" style="white-space: nowrap; min-width:100px;" class="text-center">
                        <i class="pi pi-ellipsis-h"></i>
                    </th>
                    <th style="white-space: nowrap;" pSortableColumn="date">
                        Ng√†y
                        <p-sortIcon field="date"></p-sortIcon>
                    </th>
                    <th style="white-space: nowrap;" pSortableColumn="time">
                        S·ªë gi·ªù
                        <p-sortIcon field="time"></p-sortIcon>
                        <p-columnFilter type="numeric" field="sumDay" display="menu" class="mt-4"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width: 100px;" class="text-center">
                        T√™n ƒë·∫ßy ƒë·ªß
                        <p-columnFilter type="text" field="member" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width: 600px;" class="text-center">
                        Ghi ch√∫ th√™m
                        <p-columnFilter type="text" field="note" display="menu"></p-columnFilter>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-WorkingOT>
                <tr>
                    <td *ngIf="checkIsLeader()" style="white-space: nowrap; text-align: center; width: 100px;">
                        <button pButton pRipple icon="pi pi-pencil"
                            class="p-button-rounded p-button-warning p-button-text p-0"
                            (click)="openEditDialog(WorkingOT)"></button>
                        <button pButton pRipple icon="pi pi-trash"
                            class="p-button-rounded p-button-danger p-button-text p-0"
                            (click)="deleteWorkingOT($event, WorkingOT)"></button>
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{WorkingOT.date | date: 'dd/MM/yyyy'}}
                    </td>
                    <td style="white-space: nowrap; text-align: center;">
                        {{WorkingOT.time}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{WorkingOT.member.fullName}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        <button pButton icon="pi pi-users" class="p-button-raised p-button-success p-button-text mr-2"
                            (click)="openOTInfoDialog(WorkingOT)">
                        </button>
                        <span>
                            {{WorkingOT.note}}
                        </span>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">Kh√¥ng c√≥ th√¥ng tin l√†m vi·ªác ngo√†i gi·ªù.</td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>

<div class="card mt-4 flex-1 p-4">
    <div echarts [options]="chartOptions" [extentions]="chartExtension">
    </div>
</div>


<p-dialog header="Th√¥ng tin l√†m vi·ªác ngo√†i gi·ªù" [(visible)]="openDialog" [style]="{width: '100%', maxWidth: '800px'}"
    [contentStyle]="{minHeight: '350px'}" [modal]="true" styleClass="p-fluid">

    <ng-template pTemplate="content">
        <div class="formgrid grid">

            <div class="field col-12 md:col-4">
                <label for="icon">Ng√†y l√†m vi·ªác</label>
                <p-calendar [(ngModel)]="WorkingOT.date" [showIcon]="true" inputId="icon"
                    dateFormat="dd/mm/yy"></p-calendar>
            </div>


            <div class="field col-5 md:col-4">
                <label for="sumDay">S·ªë gi·ªù</label>
                <input type="number" pInputText id="time" required [(ngModel)]="WorkingOT.time" />
            </div>

            <div class="field col-12">
                <label for="reason">Nh√¢n vi√™n</label>
                <p-dropdown *ngIf="checkIsLeader()" [options]="MemberList" [(ngModel)]="WorkingOT.member.id"
                    optionLabel="fullName" optionValue="id" required>
                </p-dropdown>
            </div>

            <div class="field col-12">
                <label>Ghi ch√∫</label>
                <textarea [rows]="5" [cols]="30" pInputTextarea [autoResize]="true"
                    [(ngModel)]="WorkingOT.note"></textarea>
            </div>

        </div>
    </ng-template>


    <!-- edit/addnew WorkingOT -->
    <ng-template pTemplate="footer">
        <button pButton pRipple label="H·ªßy" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton pRipple label="L∆∞u" icon="pi pi-check" class="p-button-text"
            (click)="editWorkingOTDialog ? updateWorkingOT() : addNewWorkingOT()"></button>
    </ng-template>
</p-dialog>

<p-dialog header="Th√¥ng tin l√†m vi·ªác ngo√†i gi·ªù" [(visible)]="isOpenOTInfoDialog"
    [style]="{width: '100%', maxWidth: '900px'}" [workingOTContentStyle]="{minHeight: '350px'}" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="workingOTContent">
        <p-scrollPanel [style]="{width: '100%', height: '700px'}">

            <div class="flex flex-column">
                <!-- <div class="flex align-items-center justify-content-left gap-3"> -->
                <div class="col-12">Ghi ch√∫:</div>
                <div class="col-12">
                    <textarea [rows]="5" [cols]="30"
                        pInputTextarea [autoResize]="true"
                        [(ngModel)]="OTDialogContent.note"
                        [readonly]="true">
                </textarea>
                </div>
            </div>
        </p-scrollPanel>
    </ng-template>

    <!-- delete member popup -->
    <p-toast></p-toast>
    <p-confirmPopup></p-confirmPopup>