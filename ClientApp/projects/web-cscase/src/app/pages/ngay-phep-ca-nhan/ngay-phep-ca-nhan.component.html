<div class="block">

    <div class="card p-4">
        <p-toolbar styleClass="mb-4 p-3">
            <p-card header="header" style="font-weight: bold; font-size: x-large; color: navy;">
                üõèÔ∏è Qu·∫£n l√Ω ng√†y ngh·ªâ ph√©p c√° nh√¢n
            </p-card>
            <ng-template pTemplate="left">
                <button pButton pRipple label="T·∫°o ng√†y ngh·ªâ ph√©p" icon="pi pi-calendar-plus mb-1"
                    class="p-button-success py-2" (click)="openAddDialog()">
                </button>
            </ng-template>
        </p-toolbar>

        <p-toolbar styleClass="mb-4 p-3">
            <div class="flex flex-row flex-wrap gap-3">
                <div class="mt-2">
                    <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                        (click)="clear(dt1)">
                    </button>
                </div>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_datefrom">
                    <label for="float-input">L·ªçc t·ª´ ng√†y</label>
                </span>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_dateto">
                    <label for="float-input">L·ªçc ƒë·∫øn ng√†y</label>
                </span>
                <span class="mt-2">
                    <!-- <button
              pButton pRipple type="button"
              label="L·ªçc"
              class="p-button-rounded p-button-info  px-4">
            </button> -->
                    <!-- <button pButton pRipple type="button" label="L·ªçc" class="p-button-outlined p-button-info px-4"></button> -->
                    <button pButton pRipple type="button" icon="pi pi-search" class="p-button-rounded p-button-info"
                        (click)="fetchDataFiltered()">
                    </button>
                </span>
            </div>
        </p-toolbar>

        <p-table #dt1 [value]="IndividualDayOffs" [rows]="10" [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[5,10,25]" [paginator]="true"
            [globalFilterFields]="['dateFrom', 'dateTo', 'sumDay', 'reason', 'note']"
            styleClass="p-datatable-gridlines p-datatable-sm" reorderableColumns="true" responsiveLayout="scroll">
            <!-- dataKey="id" -->
            <!-- currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" -->
            <!-- styleClass="p-datatable-customers p-datatable-gridlines" -->

            <ng-template pTemplate="header">
                <tr>
                    <th style="white-space: nowrap; min-width:120px;" class="text-center">
                        <i class="pi pi-ellipsis-h"></i>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" class="text-center">
                        Tr·∫°ng th√°i
                        <p-columnFilter type="text" field="reason" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" pSortableColumn="dateFrom">
                        Ng√†y b·∫Øt ƒë·∫ßu
                        <p-sortIcon field="dateFrom"></p-sortIcon>
                        <!-- <p-columnFilter type="date" field="dateFrom" display="menu">
              </p-columnFilter> -->
                        <!-- <p-columnFilter type="date" field="dateFrom" display="menu" [showMatchModes]="true" [showOperator]="false"
                [showAddButton]="false">
              </p-columnFilter> -->
                    </th>
                    <th style="white-space: nowrap; min-width:10rem " pSortableColumn="dateTo">
                        Ng√†y k·∫øt th√∫c
                        <!-- <p-columnFilter type="date" field="dateTo" display="menu">
              </p-columnFilter> -->
                        <p-sortIcon field="dateTo"></p-sortIcon>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" pSortableColumn="sumDay">
                        T·ªïng s·ªë ng√†y ngh·ªâ
                        <p-sortIcon field="sumDay"></p-sortIcon>
                        <p-columnFilter type="numeric" field="sumDay" display="menu" class="mt-4"></p-columnFilter>
                    <th style="white-space: nowrap; min-width:10rem" class="text-center">
                        H·ªç t√™n
                        <p-columnFilter type="text" field="reason" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width:20rem" class="text-center">
                        L√Ω do ngh·ªâ
                        <p-columnFilter type="text" field="reason" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" class="text-center">
                        T√≠nh v√†o ngh·ªâ ph√©p nƒÉm
                        <p-columnFilter type="text" field="reason" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" class="text-center">
                        Ngh·ªâ kh√¥ng l∆∞∆°ng
                        <p-columnFilter type="text" field="reason" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        Ghi ch√∫ th√™m
                        <p-columnFilter type="text" field="note" display="menu"></p-columnFilter>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-IndividualDayOff>
                <tr>
                    <td style="white-space: nowrap; text-align: center; width: 100px;">
                        <!-- leader action-->
                        <span *ngIf="checkIsLeader()">
                            <button pButton icon="pi pi-check-circle"
                                class="p-button-raised p-button-success p-button-text mr-2"
                                (click)="openViewDialog(IndividualDayOff)">
                            </button>
                            <button pButton pRipple icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning p-button-text p-0"
                                (click)="openEditDialog(IndividualDayOff)"></button>
                            <button pButton pRipple icon="pi pi-trash"
                                class="p-button-rounded p-button-danger p-button-text p-0"
                                (click)="deleteIndividualDayOff($event, IndividualDayOff)"></button>
                        </span>

                        <!-- member action -->
                        <span *ngIf="!checkIsLeader()">
                            <button pButton icon="pi pi-check-circle"
                                class="p-button-raised p-button-success p-button-text mr-2"
                                (click)="openViewDialog(IndividualDayOff)">
                            </button>
                            <button
                                [disabled]="IndividualDayOff.approvalStatus === 'ƒê√£ duy·ªát' || IndividualDayOff.approvalStatus === 'T·ª´ ch·ªëi'"
                                pButton pRipple icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning p-button-text p-0"
                                (click)="openEditDialog(IndividualDayOff)"></button>
                            <button pButton pRipple icon="pi pi-trash"
                                [disabled]="IndividualDayOff.approvalStatus === 'ƒê√£ duy·ªát' || IndividualDayOff.approvalStatus === 'T·ª´ ch·ªëi'"
                                class="p-button-rounded p-button-danger p-button-text p-0"
                                (click)="deleteIndividualDayOff($event, IndividualDayOff)"></button>
                        </span>
                    </td>
                    <td style="white-space: nowrap; text-align: center; width: 15%;">
                        <p-tag *ngIf="IndividualDayOff.approvalStatus === 'ƒê√£ duy·ªát'"
                            value="{{IndividualDayOff.approvalStatus}}" icon="pi pi-check" severity="success">
                        </p-tag>
                        <p-tag *ngIf="IndividualDayOff.approvalStatus === 'T·ª´ ch·ªëi'"
                            value="{{IndividualDayOff.approvalStatus}}" icon="pi pi-times" severity="danger">
                        </p-tag>
                        <p-tag *ngIf="IndividualDayOff.approvalStatus === 'Ch∆∞a duy·ªát'"
                            value="{{IndividualDayOff.approvalStatus}}" icon="pi pi-exclamation-triangle"
                            severity="warning">
                        </p-tag>
                        <!-- {{IndividualDayOff.approvalStatus}} -->
                    </td>
                    <td style="white-space: nowrap; text-align: left; width: 12%;">
                        {{IndividualDayOff.dateFrom | date: 'dd/MM/yyyy'}}
                    </td>
                    <td style="white-space: nowrap; text-align: left; width: 12%;">
                        {{IndividualDayOff.dateTo | date: 'dd/MM/yyyy'}}
                    </td>
                    <td style="white-space: nowrap; text-align: center; width: 15%;">
                        <span style="color:black; font-weight: bold;">{{IndividualDayOff.sumDay}}</span>
                    </td>
                    <td style="white-space: nowrap; text-align: center; width: 15%;">
                        {{IndividualDayOff.member.fullName}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{IndividualDayOff.reason}}
                    </td>
                    <td style="white-space: nowrap; text-align: center;">
                        <span *ngIf="IndividualDayOff.isAnnual" style="color: green; ">C√≥</span>
                        <span *ngIf="!IndividualDayOff.isAnnual" style="color: red;">Kh√¥ng</span>
                        <!-- {{IndividualDayOff.isAnnual}} -->
                    </td>
                    <td style="white-space: nowrap; text-align: center;">
                        <span *ngIf="IndividualDayOff.isWithoutPay" style="color: green; ">C√≥</span>
                        <span *ngIf="!IndividualDayOff.isWithoutPay" style="color: red;">Kh√¥ng</span>
                        <!-- {{IndividualDayOff.isWithoutPay}} -->
                    </td>
                    <td style="white-space: nowrap; text-align: left; max-width: 30rem">
                        <p-scrollPanel [style]="{width: '100%', height: '50px'}">
                            {{IndividualDayOff.note}}
                        </p-scrollPanel>
                    </td>

                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="10">Kh√¥ng c√≥ ng√†y ph√©p n√†o. Qu√° gi·ªèi.</td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>


<p-dialog header="Nh·∫≠p th√¥ng tin ng√†y ngh·ªâ ph√©p" [(visible)]="openDialog" [style]="{width: '100%', maxWidth: '800px'}"
    [contentStyle]="{minHeight: '350px'}" [modal]="true" styleClass="p-fluid">

    <ng-template pTemplate="content">
        <div class="formgrid grid">

            <div class="col-12 mb-4" *ngIf="!checkIsLeader()">
                <span>
                    <strong>Nh√¢n vi√™n: </strong>
                </span>
                <span>
                    {{ userInfo.fullName }}
                </span>
            </div>

            <div class="field col-12 md:col-4">
                <label for="icon">Ng√†y b·∫Øt ƒë·∫ßu</label>
                <p-calendar [(ngModel)]="IndividualDayOff.dateFrom" [showIcon]="true" inputId="icon"
                    dateFormat="dd/mm/yy" (ngModelChange)="sumDay()">
                </p-calendar>
            </div>

            <div class="field col-12 md:col-4">
                <label for="icon">Ng√†y k·∫øt th√∫c</label>
                <p-calendar [(ngModel)]="IndividualDayOff.dateTo" [showIcon]="true" inputId="icon" dateFormat="dd/mm/yy"
                    (ngModelChange)="sumDay()">
                </p-calendar>
            </div>


            <div class="field col-5 md:col-4">
                <label for="sumDay">S·ªë l∆∞·ª£ng ng√†y ngh·ªâ</label>
                <input type="number" pInputText id="sumDay" required [(ngModel)]="IndividualDayOff.sumDay" />
            </div>

            <div *ngIf="!isValidDateRange" class="field col-12" style="color: red;">
                *kho·∫£ng th·ªùi gian kh√¥ng h·ª£p l·ªá
            </div>

            <div class="field col-12">
                <label *ngIf="checkIsLeader()" for="memberId">H·ªç t√™n nh√¢n vi√™n
                </label>
                <p-dropdown *ngIf="checkIsLeader()"
                    [options]="MemberList"
                    [(ngModel)]="IndividualDayOff.member.id"
                    optionLabel="fullName"
                    [filter]="true"
                    filterBy="fullName"
                    [showClear]="true"
                    placeholder="Ch·ªçn nh√¢n vi√™n"
                    optionValue="id">
                </p-dropdown>
            </div>
            <div *ngIf="checkIsLeader()" class="mt-2">
            </div>

            <div class="p-field-checkbox flex flex-row col-12 sm:col-5 md:col-4">
                <p-checkbox class="pb-2 mr-2" [(ngModel)]="IndividualDayOff.isAnnual" binary="true" inputId="isAnnual">
                </p-checkbox>
                <label for="isAnnual">T√≠nh v√†o ngh·ªâ ph√©p nƒÉm</label>
            </div>

            <div class="p-field-checkbox flex flex-row col-12 sm:col-5 md:col-4">
                <p-checkbox class="pb-2 mr-2" [(ngModel)]="IndividualDayOff.isWithoutPay" binary="true"
                    inputId="isWithoutPay">
                </p-checkbox>
                <label for="isWithoutPay">Ngh·ªâ kh√¥ng l∆∞∆°ng</label>
            </div>

            <div class="field col-12 mt-2">
                <label for="reason">L√≠ do ngh·ªâ ph√©p</label>
                <input type="text" pInputText id="reason" required [(ngModel)]="IndividualDayOff.reason" />
            </div>

            <div class="field col-12">
                <label>Ghi ch√∫</label>
                <textarea [rows]="5" [cols]="30" pInputTextarea [autoResize]="true"
                    [(ngModel)]="IndividualDayOff.note"></textarea>
            </div>

            <div class="field col-12" *ngIf="checkIsLeader()">
                <label for="approvalStatus">Tr·∫°ng th√°i</label>
                <p-selectButton [options]="approvalStatusOptions" [(ngModel)]="IndividualDayOff.approvalStatus"
                    optionLabel="label" optionValue="value">
                </p-selectButton>
            </div>

        </div>
    </ng-template>


    <!-- edit/addnew DayOff -->
    <ng-template pTemplate="footer">
        <!-- icon="pi pi-times" -->
        <button pButton pRipple label="Suy nghƒ© l·∫°i" class="p-button-text" (click)="hideDialog()"></button>
        <!-- icon="pi pi-check"  -->
        <button
            [disabled]="!isValidDateRange"
            pButton pRipple label="+1 Ch·ªØa l√†nh" class="p-button-text"
            (click)="editIndividualDayOffDialog ? updateIndividualDayOff() : addNewIndividualDayOff()"></button>
    </ng-template>
</p-dialog>

<!-- delete member popup -->
<p-toast></p-toast>
<p-confirmPopup></p-confirmPopup>

<!-- detail view dialog -->
<p-dialog header="Th√¥ng tin ng√†y ngh·ªâ ph√©p c√° nh√¢n" [(visible)]="viewIndividualDayOffDialog"
    [style]="{width: '100%', maxWidth: '900px'}" [comissionContentStyle]="{minHeight: '350px'}" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="comissionContent">
        <p-scrollPanel [style]="{width: '100%', height: '700px'}">

            <div class="flex flex-column">
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Nh√¢n vi√™n:</span>
                    <span>
                        {{IndividualDayOff.member.fullName}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">T·ª´ ng√†y:</span>
                    <span class="">
                        {{IndividualDayOff.dateFrom | date: 'dd/MM/yyyy'}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">ƒê·∫øn ng√†y:</span>
                    <span>
                        {{IndividualDayOff.dateTo | date: 'dd/MM/yyyy'}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">S·ªë l∆∞·ª£ng ng√†y:</span>
                    <span>
                        {{IndividualDayOff.sumDay}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">T√≠nh v√†o ngh·ªâ ph√©p nƒÉm</span>
                    <span>
                        <span *ngIf="IndividualDayOff.isAnnual">C√≥</span>
                        <span *ngIf="!IndividualDayOff.isAnnual">Kh√¥ng</span>
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Ngh·ªâ kh√¥ng l∆∞∆°ng</span>
                    <span>
                        <span *ngIf="IndividualDayOff.isWithoutPay">C√≥</span>
                        <span *ngIf="!IndividualDayOff.isWithoutPay">Kh√¥ng</span>
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">L√Ω do ngh·ªâ ph√©p:</span>
                    <span>
                        {{IndividualDayOff.reason}}
                    </span>
                </div>
                <p-divider></p-divider>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Ghi ch√∫</span>
                    <span>
                        {{IndividualDayOff.note}}
                    </span>
                </div>
                <p-divider></p-divider>
                <div class="flex align-items-center justify-content-left">
                    <span class="col-4">Tr·∫°ng th√°i:</span>
                    <span class="col-4">
                        <!-- {{IndividualDayOff.approvalStatus}} -->
                        <div class="flex flex-row">
                            <p-dropdown *ngIf="checkIsLeader()" [options]="approvalStatusOptions"
                                [(ngModel)]="IndividualDayOff.approvalStatus" optionLabel="label" optionValue="value"
                                (click)="saveApprovalStatus(IndividualDayOff)">
                            </p-dropdown>
                            <span *ngIf="!checkIsLeader()" class="ml-2" style="font-weight: bold;">
                                {{IndividualDayOff.approvalStatus}}
                            </span>
                        </div>
                    </span>
                </div>
                <div>

                </div>
            </div>

        </p-scrollPanel>
    </ng-template>
</p-dialog>

<div class="card mt-4 flex-1 p-4">
    <div echarts [options]="chartOptions" [extentions]="chartExtension">
    </div>
</div>