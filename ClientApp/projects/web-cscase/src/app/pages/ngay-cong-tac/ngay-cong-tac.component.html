<div class="block">

    <div class="card p-4">
        <p-toolbar styleClass="mb-4 p-3">
            <p-card *ngIf="checkIsLeader()" header="header" style="font-weight: bold; font-size: x-large; color: navy;">
                üíº Qu·∫£n l√Ω ng√†y c√¥ng t√°c
            </p-card>
            <p-card *ngIf="!checkIsLeader()" header="header"
                style="font-weight: bold; font-size: x-large; color: navy;">
                Th√¥ng tin ng√†y c√¥ng t√°c
            </p-card>
            <ng-template *ngIf="checkIsLeader()" pTemplate="left">
                <button pButton pRipple label="T·∫°o ng√†y c√¥ng t√°c" icon="pi pi-calendar-plus mb-1"
                    class="p-button-success py-2" (click)="openAddDialog()">
                </button>
            </ng-template>
        </p-toolbar>

        <p-toolbar styleClass="mb-4 p-3">
            <div class="flex flex-row flex-wrap gap-3">
                <div class="mt-2">
                    <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                        (click)="clear(dt1)">
                    </button>
                </div>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_datefrom">
                    <label for="float-input">L·ªçc t·ª´ ng√†y</label>
                </span>
                <span class="p-float-label mt-2">
                    <input id="float-input" type="text" pInputText [(ngModel)]="filter_dateto">
                    <label for="float-input">L·ªçc ƒë·∫øn ng√†y</label>
                </span>
                <span class="mt-2">
                    <button pButton pRipple type="button" icon="pi pi-search" class="p-button-rounded p-button-info"
                        (click)="fetchDataFiltered()">
                    </button>
                </span>
            </div>
        </p-toolbar>

        <p-table #dt1 [value]="CommissionDays" [rows]="10" [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[5,10,15]" [paginator]="true"
            [globalFilterFields]="['dateFrom', 'dateTo', 'sumDay', 'comissionContent', 'note']"
            styleClass="p-datatable-gridlines p-datatable-sm" reorderableColumns="true" responsiveLayout="scroll">
            <!-- dataKey="id" -->
            <ng-template pTemplate="header">
                <tr>
                    <th style="white-space: nowrap; min-width:120px;" class="text-center">
                        <i class="pi pi-ellipsis-h"></i>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" pSortableColumn="dateFrom">
                        Ng√†y b·∫Øt ƒë·∫ßu
                        <p-sortIcon field="dateFrom"></p-sortIcon>
                        <!-- <p-columnFilter type="date" field="dateFrom" display="menu">
              </p-columnFilter> -->
                        <!-- <p-columnFilter type="date" field="dateFrom" display="menu" [showMatchModes]="true" [showOperator]="false"
                [showAddButton]="false">
              </p-columnFilter> -->
                    </th>
                    <th style="white-space: nowrap; min-width:10rem " pSortableColumn="dateTo">
                        Ng√†y k·∫øt th√∫c
                        <!-- <p-columnFilter type="date" field="dateTo" display="menu">
              </p-columnFilter> -->
                        <p-sortIcon field="dateTo"></p-sortIcon>
                    </th>
                    <th style="white-space: nowrap; min-width:10rem" pSortableColumn="sumDay">
                        S·ªë l∆∞·ª£ng ng√†y
                        <p-sortIcon field="sumDay"></p-sortIcon>
                        <p-columnFilter type="numeric" field="sumDay" display="menu" class="mt-4"></p-columnFilter>
                    <th style="white-space: nowrap; min-width:25rem" class="text-center">
                        N·ªôi dung c√¥ng t√°c
                        <p-columnFilter type="text" field="comissionContent" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        Ph∆∞∆°ng ti·ªán
                        <p-columnFilter type="text" field="transportation" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        Danh s√°ch nh√¢n vi√™n
                        <p-columnFilter type="text" field="memberList" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        C√¥ng t√°c ph√≠
                        <p-columnFilter type="text" field="commissionExpenses" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        Chi ph√≠ c√¥ng t√°c
                        <p-columnFilter type="number" field="commissionExpenses" display="menu"></p-columnFilter>
                    </th>
                    <th style="white-space: nowrap;" class="text-center">
                        Ghi ch√∫
                        <p-columnFilter type="text" field="note" display="menu"></p-columnFilter>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-CommissionDay>
                <tr>
                    <td style="white-space: nowrap; text-align: center; width: 100px;">
                        <button pButton icon="pi pi-users" class="p-button-raised p-button-success p-button-text mr-2"
                            (click)="openMemberDialog(CommissionDay)">
                        </button>
                        <button *ngIf="checkIsLeader()" pButton pRipple icon="pi pi-pencil"
                            class="p-button-rounded p-button-warning p-button-text p-0"
                            (click)="openEditDialog(CommissionDay)">
                        </button>
                        <button *ngIf="checkIsLeader()" pButton pRipple icon="pi pi-trash"
                            class="p-button-rounded p-button-danger p-button-text p-0"
                            (click)="deleteCommissionDay($event, CommissionDay)">
                        </button>
                    </td>
                    <td style="white-space: nowrap; text-align: left; width: 12%;">
                        {{CommissionDay.dateFrom | date: 'dd/MM/yyyy'}}
                    </td>
                    <td style="white-space: nowrap; text-align: left; width: 12%;">
                        {{CommissionDay.dateTo | date: 'dd/MM/yyyy'}}
                    </td>
                    <td style="white-space: nowrap; text-align: center; width: 15%;">
                        {{CommissionDay.sumDay}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{CommissionDay.comissionContent}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{CommissionDay.transportation}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        <div class="flex flex-row gap-2">
                            <span class="align-content-center">
                                {{getMemberList(CommissionDay.memberList)}}
                            </span>
                        </div>
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{sumExpenses(CommissionDay.memberList) | currency: 'VND'}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{CommissionDay.commissionExpenses | currency: 'VND'}}
                    </td>
                    <td style="white-space: nowrap; text-align: left;">
                        {{CommissionDay.note}}
                    </td>

                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">Kh√¥ng c√≥ th√¥ng tin ng√†y c√¥ng t√°c.</td>
                </tr>
            </ng-template>
        </p-table>

    </div>
</div>


<p-dialog header="Th√¥ng tin ng√†y c√¥ng t√°c" [(visible)]="openDialog" [style]="{width: '100%', maxWidth: '800px'}"
    [comissionContentStyle]="{minHeight: '350px'}" [modal]="true" styleClass="p-fluid">

    <ng-template pTemplate="comissionContent">
        <div class="formgrid grid">

            <div class="field col-12 md:col-4">
                <label for="icon">Ng√†y b·∫Øt ƒë·∫ßu</label>
                <p-calendar [(ngModel)]="CommissionDay.dateFrom" [showIcon]="true" inputId="icon" dateFormat="dd/mm/yy"
                    (ngModelChange)="sumDay()"></p-calendar>
            </div>

            <div class="field col-12 md:col-4">
                <label for="icon">Ng√†y k·∫øt th√∫c</label>
                <p-calendar [(ngModel)]="CommissionDay.dateTo" [showIcon]="true" inputId="icon" dateFormat="dd/mm/yy"
                    (ngModelChange)="sumDay()"></p-calendar>
            </div>


            <div class="field col-5 md:col-4">
                <label for="sumDay">S·ªë l∆∞·ª£ng ng√†y c√¥ng t√°c</label>
                <input type="number" pInputText id="sumDay" required [(ngModel)]="CommissionDay.sumDay" />
            </div>

            <div class="field col-12">
                <label for="reason">N·ªôi dung c√¥ng t√°c</label>
                <input type="text" pInputText id="reason" required [(ngModel)]="CommissionDay.comissionContent" />
            </div>

            <div class="field col-12">
                <label for="reason">Ph∆∞∆°ng ti·ªán</label>
                <input type="text" pInputText id="reason" required [(ngModel)]="CommissionDay.transportation" />
            </div>

            <div class="field col-12">
                <div>
                    <div class="">
                        Danh s√°ch ƒëi c√¥ng t√°c
                    </div>
                    <div *ngFor="let member of CommissionDay.memberList; let i = index">
                        <div class="grid mt-2">
                            <div class="col-6">
                                <p-dropdown [options]="CommissionMemberList" [(ngModel)]="member.id"
                                    optionLabel="fullName" optionValue="id">
                                </p-dropdown>
                            </div>
                            <div class="col-5">
                                <p-inputNumber [(ngModel)]="member.memberExpenses" mode="currency" currency="VND">
                                </p-inputNumber>
                            </div>
                            <div class="col-1">
                                <button pButton pRipple type="button" icon="pi pi-times"
                                    class="p-button-rounded p-button-danger p-button-text"
                                    (click)="removeMember(member)">
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <button pButton pRipple type="button" label="Th√™m nh√¢n s·ª±"
                            class="p-button-info p-button-text mt-2" (click)="addMember()">
                        </button>
                    </div>
                </div>
            </div>

            <div class="field col-12">

                <label for="reason">Chi ph√≠ c√¥ng t√°c</label>
                <p-inputNumber [(ngModel)]="CommissionDay.commissionExpenses" mode="currency" currency="VND">
                </p-inputNumber>
            </div>

            <div class="field col-12">
                <label>Ghi ch√∫ chi ph√≠ c√¥ng t√°c</label>
                <textarea [rows]="5" [cols]="30" pInputTextarea [autoResize]="true"
                    [(ngModel)]="CommissionDay.note"></textarea>
            </div>

        </div>
    </ng-template>


    <!-- edit/addnew CommissionDay -->
    <ng-template pTemplate="footer">
        <button pButton pRipple label="H·ªßy" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton pRipple label="L∆∞u" icon="pi pi-check" class="p-button-text"
            (click)="editCommissionDayDialog ? updateCommissionDay() : addNewCommissionDay()"></button>
    </ng-template>
</p-dialog>

<p-dialog header="Th√¥ng tin th√†nh vi√™n ng√†y c√¥ng t√°c" [(visible)]="isOpenMemberDialog"
    [style]="{width: '100%', maxWidth: '900px'}" [comissionContentStyle]="{minHeight: '350px'}" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="comissionContent">
        <p-scrollPanel [style]="{width: '100%', height: '700px'}">

            <div class="flex flex-column">
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">T·ª´ ng√†y:</span>
                    <span class="">
                        {{CommissionDay.dateFrom | date: 'dd/MM/yyyy'}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">ƒê·∫øn ng√†y:</span>
                    <span>
                        {{CommissionDay.dateTo | date: 'dd/MM/yyyy'}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">S·ªë l∆∞·ª£ng ng√†y:</span>
                    <span>
                        {{CommissionDay.sumDay}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">N·ªôi dung c√¥ng t√°c:</span>
                    <span>
                        {{CommissionDay.comissionContent}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Ph∆∞∆°ng ti·ªán di chuy·ªÉn:</span>
                    <span>
                        {{CommissionDay.transportation}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Chi ph√≠ c√¥ng t√°c:</span>
                    <span>
                        {{CommissionDay.commissionExpenses | currency: 'VND'}}
                    </span>
                </div>
                <div class="flex align-items-center justify-content-left gap-3">
                    <span class="col-4">Ghi ch√∫ chi ph√≠ c√¥ng t√°c:</span>
                    <span>
                        {{CommissionDay.note}}
                    </span>
                </div>
                <p-divider></p-divider>
            </div>

            <div class="flex flex-column">
                <span class="">Danh s√°ch nh√¢n s·ª±:</span>
                <div class="flex justify-content-center mt-4">
                    <p-table [value]="CommissionDay.memberList" styleClass="p-datatable-sm p-datatable-gridlines"
                        [tableStyle]="{'width': '600px'}">
                        <!-- <ng-template pTemplate="caption">
                        Header
                    </ng-template> -->
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="white-space: nowrap; width:50%">H·ªç t√™n</th>
                                <th style="white-space: nowrap; width:50%">C√¥ng t√°c ph√≠</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-member>
                            <tr>
                                <td>{{member.fullName}}</td>
                                <td>{{member.memberExpenses | currency: 'VND'}}</td>
                            </tr>
                        </ng-template>
                        <!-- <ng-template pTemplate="summary">
                        Footer
                    </ng-template> -->
                    </p-table>
                </div>
            </div>
        </p-scrollPanel>
    </ng-template>
</p-dialog>
<div class="card mt-4 sm:mt-0 flex-1 p-4">
    <div echarts [options]="chartOptions" [extentions]="chartExtension">
    </div>
</div>
<!-- delete member popup -->
<p-toast></p-toast>
<p-confirmPopup></p-confirmPopup>